#!/bin/bash

MODE_FILE="$HOME/.cache/.waybar_mode"
CURRENT_MODE=$(cat "$MODE_FILE" 2>/dev/null || echo "static")

STATIC="Static"
DYNAMIC="Dynamic"
HOVER="Hover"

CHOICE=$(echo -e "$STATIC\n$DYNAMIC\n$HOVER" | rofi -dmenu -p "Select Navbar Mode" -no-cache -theme-str 'listview { lines: 3; scrollbar: false; }')

if [ -z "$CHOICE" ]; then
    exit 0
fi

stop_services() {
    systemctl --user stop navbar.service navbar-hover.service navbar-watcher.service
    killall waybar 2>/dev/null
}

case "$CHOICE" in
    "$STATIC")
        if [ "$CURRENT_MODE" != "static" ]; then
            stop_services
            systemctl --user start navbar.service
            echo "static" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Static mode enabled." true
        fi
        ;;
        
    "$DYNAMIC")
        if [ "$CURRENT_MODE" != "dynamic" ]; then
            stop_services
            systemctl --user start navbar-watcher.service
            echo "dynamic" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Dynamic mode enabled." true
        fi
        ;;
        
    "$HOVER")
        if [ "$CURRENT_MODE" != "hover" ]; then
            stop_services
            systemctl --user start navbar-hover.service
            echo "hover" > "$MODE_FILE"
            makenotif customize preferences-system "Navbar" "Hover mode enabled." true
        fi
        ;;
esac
